import React from 'react'
import {connect} from 'react-redux'
import R from 'ramda'
import InfoAboutDelivery from 'containers/basket/infoAboutDelivery'
import FromDelivery from 'containers/basket/formDelivery'
import {removePizzaFromBasket} from 'actions'


import {
       getTotalBasketPrice,
       getBasketPizzaWithCount,
       getDeliveryPrice
} from 'selectors'

const Basket = ({pizza, totalPrice, deliveryPrice, removePizzaFromBasket}) => {
    const isBasketEmpty = R.isEmpty(pizza)
    const renderContent = () => (
       <div className='row'>
           {isBasketEmpty && <div>Корзина пуста</div>}
           <div className='table-responsive'>
               <table className='table-bordered  table-condensed cf'>
                   <tbody>
                   {pizza.map((p, index) => (
                       <tr
                           key={index}
                           className='item-checout'
                       >
                           <td
                           className='first-column-checkout'>
                               <img
                               className='img-thumbnail'
                               src={p.image}
                               alt={p.name}
                               />
                           </td>
                           <td>{p.name}</td>
                           <td>{p.price}</td>
                           <td>{p.count}</td>
                           <td>
                               <span className='delete-cart'
                               onClick={() => removePizzaFromBasket(p.id)}
                               >
                               </span>
                           </td>
                       </tr>
                   ))}
                   </tbody>
               </table>
           </div>
           {
               R.not(isBasketEmpty) &&
                   <div className='row'>
                       <div className='pull-right total-user-checkout'>
                           <b>К оплате : {totalPrice} руб.</b><br/>
                           <b>Доставка: {deliveryPrice} руб.</b><br/>
                           <b>Общая стоимость с доставкой: {deliveryPrice + totalPrice} руб.</b><br/>
                       </div>
                   </div>
           }
           <br/><br/>
           {!isBasketEmpty && <InfoAboutDelivery />}
           {R.not(isBasketEmpty) &&  <FromDelivery order={pizza}/>}
       </div>
    )
    return (
        <div className='view-container'>
            <div className='container'>
                <div className='row'>
                    <div className='col-md-9'>
                        {renderContent()}
                    </div>
                </div>
            </div>
        </div>
    )
}

const mapDispatchToProps  = {
    removePizzaFromBasket
}

const mapStateToProps = state => ({
    pizza: getBasketPizzaWithCount(state),
    totalPrice: getTotalBasketPrice(state),
    deliveryPrice : getDeliveryPrice(state)
})
export default  connect(mapStateToProps, mapDispatchToProps)(Basket)
